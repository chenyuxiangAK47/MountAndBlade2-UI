# QuickStartMod 可验证性增强说明

## 改进内容

### 1. 按钮文字唯一化
- **之前**: "快速开始"（可能与 DLC 混淆）
- **现在**: "QS MOD 快速开始"（唯一标识符，绝不会与 DLC 混淆）

### 2. 三重验证机制
按钮点击时会同时输出三种日志：

1. **rgl_log 日志**（游戏标准日志）
   - 格式: `[QuickStart] >>> QS BUTTON CLICKED <<<`
   - 位置: `logs/rgl_log_*.txt`

2. **屏幕提示**（用户可见，绝不会"找错日志"）
   - 显示: `[QS MOD] 快速开始按钮已点击！正在启动新游戏...`
   - 绿色文字，在游戏界面顶部显示

3. **文件日志**（独立文件，不依赖游戏日志系统）
   - 位置: `Modules/QuickStartMod/qs_runtime.log`
   - 包含时间戳和详细操作记录

### 3. 角色创建自动跳过日志增强
所有关键操作都会同时写入：
- Debug.Print（rgl_log）
- 文件日志（qs_runtime.log）

包括：
- 状态变化（ActiveState）
- 找到 CharacterCreationContent
- 设置文化为瓦兰迪亚
- 切换到下一个菜单

## 下一步操作

### 步骤 1: 安装 ILSpyCmd（如果还没安装）

```powershell
dotnet tool install --global ilspycmd
```

### 步骤 2: 运行反编译脚本

```powershell
cd "D:\SteamLibrary\steamapps\common\Mount & Blade II Bannerlord\Modules\QuickStartMod"
.\decompile_bannerlord.ps1
```

这将把 Bannerlord 的 DLL 反编译到 `D:\Bannerlord_Decompiled\` 目录。

### 步骤 3: 搜索 CharacterCreation 相关类型

在导出的源码中搜索：

```powershell
# 如果安装了 ripgrep (rg)
rg -n "CharacterCreation|CultureSelection|BackgroundSelection|ExecuteNext|NextCommand" D:\Bannerlord_Decompiled

# 或者使用 PowerShell
Get-ChildItem -Path "D:\Bannerlord_Decompiled" -Recurse -Filter "*.cs" | Select-String -Pattern "CharacterCreation" | Select-Object -First 50
```

### 步骤 4: 找到真实类型名后

将找到的类型名/方法名提供给开发者，用于：
1. 修正 `QuickStartCharCreationSkipper` 中的类型查找逻辑
2. 确保使用正确的 API 调用
3. 实现精准的角色创建自动跳过

## 验证按钮是否工作

### 方法 1: 查看屏幕提示
点击按钮后，应该看到绿色文字提示：`[QS MOD] 快速开始按钮已点击！正在启动新游戏...`

### 方法 2: 查看文件日志
检查 `Modules/QuickStartMod/qs_runtime.log`，应该看到：
```
[2025-12-19 HH:mm:ss.fff] [QuickStart] >>> QS BUTTON CLICKED <<<
```

### 方法 3: 查看 rgl_log
在最新的 `logs/rgl_log_*.txt` 中搜索 `QS BUTTON CLICKED`。

## 注意事项

1. **文件日志路径**: 如果 `qs_runtime.log` 没有生成，检查 `Modules/QuickStartMod/` 目录的写入权限。

2. **按钮显示**: 如果看不到 "QS MOD 快速开始" 按钮，检查：
   - Harmony 补丁是否成功应用
   - 查看 rgl_log 中是否有 `[QuickStart] EnsureQuickStart` 相关日志

3. **反编译失败**: 如果 ILSpyCmd 安装失败，可以：
   - 使用 dnSpy 手动导出单个 DLL
   - 或者直接使用 dnSpy 搜索类型（GUI 方式）

## 文件清单

- `decompile_bannerlord.ps1` - 批量反编译脚本
- `安装ILSpyCmd.md` - ILSpyCmd 安装指南
- `改进说明_可验证性增强.md` - 本文档

